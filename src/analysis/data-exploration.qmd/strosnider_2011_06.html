<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Katerina Bischel">
<meta name="dcterms.date" content="2025-07-07">

<title>Enhanced Cerro Rico AMD Chemistry Analysis (2006–2007)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="strosnider_2011_06_files/libs/clipboard/clipboard.min.js"></script>
<script src="strosnider_2011_06_files/libs/quarto-html/quarto.js"></script>
<script src="strosnider_2011_06_files/libs/quarto-html/popper.min.js"></script>
<script src="strosnider_2011_06_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="strosnider_2011_06_files/libs/quarto-html/anchor.min.js"></script>
<link href="strosnider_2011_06_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="strosnider_2011_06_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="strosnider_2011_06_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="strosnider_2011_06_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="strosnider_2011_06_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>
<script src="strosnider_2011_06_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="strosnider_2011_06_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#setup-and-data-loading" id="toc-setup-and-data-loading" class="nav-link" data-scroll-target="#setup-and-data-loading">Setup and Data Loading</a>
  <ul class="collapse">
  <li><a href="#load-required-libraries" id="toc-load-required-libraries" class="nav-link" data-scroll-target="#load-required-libraries">Load Required Libraries</a></li>
  <li><a href="#utility-functions" id="toc-utility-functions" class="nav-link" data-scroll-target="#utility-functions">Utility Functions</a></li>
  <li><a href="#additional-utility-functions" id="toc-additional-utility-functions" class="nav-link" data-scroll-target="#additional-utility-functions">Additional Utility Functions</a></li>
  <li><a href="#data-loading-and-file-detection" id="toc-data-loading-and-file-detection" class="nav-link" data-scroll-target="#data-loading-and-file-detection">Data Loading and File Detection</a></li>
  <li><a href="#data-import-and-initial-processing" id="toc-data-import-and-initial-processing" class="nav-link" data-scroll-target="#data-import-and-initial-processing">Data Import and Initial Processing</a></li>
  </ul></li>
  <li><a href="#data-validation-and-column-detection" id="toc-data-validation-and-column-detection" class="nav-link" data-scroll-target="#data-validation-and-column-detection">Data Validation and Column Detection</a>
  <ul class="collapse">
  <li><a href="#metal-detection-and-regulatory-standards" id="toc-metal-detection-and-regulatory-standards" class="nav-link" data-scroll-target="#metal-detection-and-regulatory-standards">Metal Detection and Regulatory Standards</a></li>
  </ul></li>
  <li><a href="#data-transformation-and-enhancement" id="toc-data-transformation-and-enhancement" class="nav-link" data-scroll-target="#data-transformation-and-enhancement">Data Transformation and Enhancement</a>
  <ul class="collapse">
  <li><a href="#create-long-format-data-for-metal-analysis" id="toc-create-long-format-data-for-metal-analysis" class="nav-link" data-scroll-target="#create-long-format-data-for-metal-analysis">Create Long Format Data for Metal Analysis</a></li>
  </ul></li>
  <li><a href="#data-quality-assessment" id="toc-data-quality-assessment" class="nav-link" data-scroll-target="#data-quality-assessment">Data Quality Assessment</a>
  <ul class="collapse">
  <li><a href="#missing-data-analysis" id="toc-missing-data-analysis" class="nav-link" data-scroll-target="#missing-data-analysis">Missing Data Analysis</a></li>
  <li><a href="#missing-data-visualization" id="toc-missing-data-visualization" class="nav-link" data-scroll-target="#missing-data-visualization">Missing Data Visualization</a></li>
  <li><a href="#data-quality-summary" id="toc-data-quality-summary" class="nav-link" data-scroll-target="#data-quality-summary">Data Quality Summary</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#ph-analysis" id="toc-ph-analysis" class="nav-link" data-scroll-target="#ph-analysis">pH Analysis</a></li>
  <li><a href="#metal-concentration-analysis" id="toc-metal-concentration-analysis" class="nav-link" data-scroll-target="#metal-concentration-analysis">Metal Concentration Analysis</a></li>
  <li><a href="#metal-concentration-visualization" id="toc-metal-concentration-visualization" class="nav-link" data-scroll-target="#metal-concentration-visualization">Metal Concentration Visualization</a></li>
  </ul></li>
  <li><a href="#seasonal-analysis" id="toc-seasonal-analysis" class="nav-link" data-scroll-target="#seasonal-analysis">Seasonal Analysis</a>
  <ul class="collapse">
  <li><a href="#statistical-comparison-between-seasons" id="toc-statistical-comparison-between-seasons" class="nav-link" data-scroll-target="#statistical-comparison-between-seasons">Statistical Comparison Between Seasons</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#seasonal-differences-visualization" id="toc-seasonal-differences-visualization" class="nav-link" data-scroll-target="#seasonal-differences-visualization">Seasonal Differences Visualization</a></li>
  <li><a href="#seasonal-ph-and-physical-parameters" id="toc-seasonal-ph-and-physical-parameters" class="nav-link" data-scroll-target="#seasonal-ph-and-physical-parameters">Seasonal pH and Physical Parameters</a></li>
  </ul></li>
  <li><a href="#site-specific-analysis" id="toc-site-specific-analysis" class="nav-link" data-scroll-target="#site-specific-analysis">Site-Specific Analysis</a>
  <ul class="collapse">
  <li><a href="#site-characterization" id="toc-site-characterization" class="nav-link" data-scroll-target="#site-characterization">Site Characterization</a></li>
  <li><a href="#site-comparison-visualization" id="toc-site-comparison-visualization" class="nav-link" data-scroll-target="#site-comparison-visualization">Site Comparison Visualization</a></li>
  </ul></li>
  <li><a href="#correlation-analysis" id="toc-correlation-analysis" class="nav-link" data-scroll-target="#correlation-analysis">Correlation Analysis</a>
  <ul class="collapse">
  <li><a href="#metal-metal-correlations" id="toc-metal-metal-correlations" class="nav-link" data-scroll-target="#metal-metal-correlations">Metal-Metal Correlations</a></li>
  <li><a href="#ph-metal-relationships" id="toc-ph-metal-relationships" class="nav-link" data-scroll-target="#ph-metal-relationships">pH-Metal Relationships</a></li>
  <li><a href="#scatter-plot-matrix" id="toc-scatter-plot-matrix" class="nav-link" data-scroll-target="#scatter-plot-matrix">Scatter Plot Matrix</a></li>
  </ul></li>
  <li><a href="#environmental-risk-assessment" id="toc-environmental-risk-assessment" class="nav-link" data-scroll-target="#environmental-risk-assessment">Environmental Risk Assessment</a>
  <ul class="collapse">
  <li><a href="#regulatory-compliance-analysis" id="toc-regulatory-compliance-analysis" class="nav-link" data-scroll-target="#regulatory-compliance-analysis">Regulatory Compliance Analysis</a></li>
  <li><a href="#risk-visualization" id="toc-risk-visualization" class="nav-link" data-scroll-target="#risk-visualization">Risk Visualization</a></li>
  </ul></li>
  <li><a href="#load-calculations-and-environmental-impact" id="toc-load-calculations-and-environmental-impact" class="nav-link" data-scroll-target="#load-calculations-and-environmental-impact">Load Calculations and Environmental Impact</a>
  <ul class="collapse">
  <li><a href="#metal-loading-analysis" id="toc-metal-loading-analysis" class="nav-link" data-scroll-target="#metal-loading-analysis">Metal Loading Analysis</a></li>
  <li><a href="#loading-visualization" id="toc-loading-visualization" class="nav-link" data-scroll-target="#loading-visualization">Loading Visualization</a></li>
  </ul></li>
  <li><a href="#summary-and-conclusions" id="toc-summary-and-conclusions" class="nav-link" data-scroll-target="#summary-and-conclusions">Summary and Conclusions</a>
  <ul class="collapse">
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link" data-scroll-target="#key-findings">Key Findings</a></li>
  <li><a href="#recommendations" id="toc-recommendations" class="nav-link" data-scroll-target="#recommendations">Recommendations</a></li>
  <li><a href="#data-export" id="toc-data-export" class="nav-link" data-scroll-target="#data-export">Data Export</a></li>
  <li><a href="#final-summary" id="toc-final-summary" class="nav-link" data-scroll-target="#final-summary">Final Summary</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Enhanced Cerro Rico AMD Chemistry Analysis (2006–2007)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Katerina Bischel </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This analysis examines acid mine drainage (AMD) chemistry data from the Cerro Rico mining area collected during 2006-2007. The study focuses on seasonal variations in metal concentrations, pH levels, and associated environmental impacts.</p>
</section>
<section id="setup-and-data-loading" class="level2">
<h2 class="anchored" data-anchor-id="setup-and-data-loading">Setup and Data Loading</h2>
<section id="load-required-libraries" class="level3">
<h3 class="anchored" data-anchor-id="load-required-libraries">Load Required Libraries</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(memoise)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="utility-functions" class="level3">
<h3 class="anchored" data-anchor-id="utility-functions">Utility Functions</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># File validation function</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>validate_files <span class="ot">&lt;-</span> <span class="cf">function</span>(files, <span class="at">file_type =</span> <span class="st">"data"</span>) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(files) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"No"</span>, file_type, <span class="st">"files found matching the pattern"</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (file <span class="cf">in</span> files) {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"File not found:"</span>, file))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ Validated"</span>, <span class="fu">length</span>(files), file_type, <span class="st">"files</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Column validation function</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>validate_columns <span class="ot">&lt;-</span> <span class="cf">function</span>(df, required_cols, <span class="at">dataset_name =</span> <span class="st">"dataset"</span>) {</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  missing_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_cols, <span class="fu">names</span>(df))</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing_cols) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Missing expected columns in"</span>, dataset_name, <span class="st">":"</span>, </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">paste</span>(missing_cols, <span class="at">collapse =</span> <span class="st">", "</span>)))</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  present_cols <span class="ot">&lt;-</span> <span class="fu">intersect</span>(required_cols, <span class="fu">names</span>(df))</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓"</span>, dataset_name, <span class="st">"has"</span>, <span class="fu">length</span>(present_cols), <span class="st">"of"</span>, </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">length</span>(required_cols), <span class="st">"expected columns</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(present_cols)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Dynamic metal detection function</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>detect_metal_columns <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Common metal symbols</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  metal_symbols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"al"</span>, <span class="st">"as"</span>, <span class="st">"cd"</span>, <span class="st">"co"</span>, <span class="st">"cr"</span>, <span class="st">"cu"</span>, <span class="st">"fe"</span>, <span class="st">"mn"</span>, <span class="st">"ni"</span>, <span class="st">"pb"</span>, <span class="st">"zn"</span>, </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"ag"</span>, <span class="st">"ba"</span>, <span class="st">"ca"</span>, <span class="st">"mg"</span>, <span class="st">"na"</span>, <span class="st">"k"</span>, <span class="st">"s"</span>, <span class="st">"si"</span>, <span class="st">"sb"</span>, <span class="st">"se"</span>, <span class="st">"mo"</span>, <span class="st">"v"</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find exact matches</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  metal_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(df)[<span class="fu">tolower</span>(<span class="fu">names</span>(df)) <span class="sc">%in%</span> metal_symbols]</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pattern matching for variations (metal_something, something_metal)</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  metal_pattern_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(df)[<span class="fu">grepl</span>(<span class="fu">paste0</span>(<span class="st">"^("</span>, <span class="fu">paste</span>(metal_symbols, <span class="at">collapse =</span> <span class="st">"|"</span>), <span class="st">")(_|$)"</span>), </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">tolower</span>(<span class="fu">names</span>(df)))]</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  detected_metals <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(metal_cols, metal_pattern_cols))</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ Detected"</span>, <span class="fu">length</span>(detected_metals), <span class="st">"metal columns:"</span>, </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(detected_metals, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(detected_metals)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhanced data cleaning function</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>clean_amd_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">dataset_name =</span> <span class="st">"dataset"</span>) {</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  original_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  original_cols <span class="ot">&lt;-</span> <span class="fu">ncol</span>(df)</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  df_clean <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove completely empty rows/columns</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">"rows"</span>, <span class="st">"cols"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize column names</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle negative values for concentrations (often measurement errors)</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">ifelse</span>(.x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">cur_column</span>() <span class="sc">!=</span> <span class="st">"temp_c"</span>, <span class="cn">NA</span>, .x))) <span class="sc">%&gt;%</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add data quality flags</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    {<span class="cf">if</span>(<span class="st">"p_h"</span> <span class="sc">%in%</span> <span class="fu">names</span>(.)) <span class="fu">mutate</span>(., </span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">ph_flag =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        p_h <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> p_h <span class="sc">&gt;</span> <span class="dv">14</span> <span class="sc">~</span> <span class="st">"out_of_range"</span>,</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>(p_h) <span class="sc">~</span> <span class="st">"missing"</span>,</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"valid"</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>      )) <span class="cf">else</span> .} <span class="sc">%&gt;%</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    {<span class="cf">if</span>(<span class="st">"q_l_s"</span> <span class="sc">%in%</span> <span class="fu">names</span>(.)) <span class="fu">mutate</span>(., </span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">flow_flag =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        q_l_s <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"negative"</span>,</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>(q_l_s) <span class="sc">~</span> <span class="st">"missing"</span>,</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"valid"</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>      )) <span class="cf">else</span> .}</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ Cleaned"</span>, dataset_name, <span class="st">":"</span>, original_rows, <span class="st">"→"</span>, <span class="fu">nrow</span>(df_clean), <span class="st">"rows,"</span>, </span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>      original_cols, <span class="st">"→"</span>, <span class="fu">ncol</span>(df_clean), <span class="st">"columns</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_clean)</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom theme function</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>theme_amd <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Set enhanced theme</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_amd</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="additional-utility-functions" class="level3">
<h3 class="anchored" data-anchor-id="additional-utility-functions">Additional Utility Functions</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Outlier detection function</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>detect_outliers <span class="ot">&lt;-</span> <span class="cf">function</span>(df, cols, <span class="at">method =</span> <span class="st">"iqr"</span>) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> cols) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (col <span class="sc">%in%</span> <span class="fu">names</span>(df) <span class="sc">&amp;&amp;</span> <span class="fu">is.numeric</span>(df[[col]])) {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (method <span class="sc">==</span> <span class="st">"iqr"</span>) {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        Q1 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df[[col]], <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        Q3 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df[[col]], <span class="fl">0.75</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        IQR <span class="ot">&lt;-</span> Q3 <span class="sc">-</span> Q1</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        lower <span class="ot">&lt;-</span> Q1 <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        upper <span class="ot">&lt;-</span> Q3 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        df[[<span class="fu">paste0</span>(col, <span class="st">"_outlier"</span>)]] <span class="ot">&lt;-</span> df[[col]] <span class="sc">&lt;</span> lower <span class="sc">|</span> df[[col]] <span class="sc">&gt;</span> upper</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical comparison function</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>compare_seasons <span class="ot">&lt;-</span> <span class="cf">function</span>(data, response_var) {</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"season"</span> <span class="sc">%in%</span> <span class="fu">names</span>(data) <span class="sc">||</span> <span class="sc">!</span>response_var <span class="sc">%in%</span> <span class="fu">names</span>(data)) {</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  test_results <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_dry =</span> <span class="fu">sum</span>(season <span class="sc">==</span> <span class="st">"dry"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_wet =</span> <span class="fu">sum</span>(season <span class="sc">==</span> <span class="st">"wet"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_dry =</span> <span class="fu">median</span>(<span class="fu">get</span>(response_var)[season <span class="sc">==</span> <span class="st">"dry"</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_wet =</span> <span class="fu">median</span>(<span class="fu">get</span>(response_var)[season <span class="sc">==</span> <span class="st">"wet"</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value =</span> <span class="fu">tryCatch</span>({</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (n_dry <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> n_wet <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">wilcox.test</span>(<span class="fu">get</span>(response_var)[season <span class="sc">==</span> <span class="st">"dry"</span>], </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">get</span>(response_var)[season <span class="sc">==</span> <span class="st">"wet"</span>])<span class="sc">$</span>p.value</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cn">NA</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>),</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">fold_change =</span> median_wet <span class="sc">/</span> median_dry,</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value_adj =</span> <span class="fu">p.adjust</span>(p_value, <span class="at">method =</span> <span class="st">"bonferroni"</span>),</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">significant =</span> p_value_adj <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(p_value_adj),</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">interpretation =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>(p_value) <span class="sc">~</span> <span class="st">"Insufficient data"</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        significant <span class="sc">&amp;</span> fold_change <span class="sc">&gt;</span> <span class="fl">1.5</span> <span class="sc">~</span> <span class="st">"Higher in wet season"</span>,</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        significant <span class="sc">&amp;</span> fold_change <span class="sc">&lt;</span> <span class="fl">0.67</span> <span class="sc">~</span> <span class="st">"Higher in dry season"</span>,</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        significant <span class="sc">~</span> <span class="st">"Significantly different"</span>,</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No significant difference"</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(test_results)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-loading-and-file-detection" class="level3">
<h3 class="anchored" data-anchor-id="data-loading-and-file-detection">Data Loading and File Detection</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== ENHANCED AMD ANALYSIS STARTING ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>=== ENHANCED AMD ANALYSIS STARTING ===</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define base path and locate files</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"raw"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Robust file detection</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>({</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">require</span>(fs, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    metal_files <span class="ot">&lt;-</span> <span class="fu">dir_ls</span>(base, <span class="at">glob =</span> <span class="st">"*metal*.xlsx"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    phys_files <span class="ot">&lt;-</span> <span class="fu">dir_ls</span>(base, <span class="at">glob =</span> <span class="st">"*physical*.xlsx"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    all_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(base, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xlsx$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    metal_files <span class="ot">&lt;-</span> all_files[<span class="fu">grepl</span>(<span class="st">"metal"</span>, all_files, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    phys_files <span class="ot">&lt;-</span> all_files[<span class="fu">grepl</span>(<span class="st">"physical"</span>, all_files, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>}, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Warning: Could not locate data files. Using sample data structure.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  metal_files <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  phys_files <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate files</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(metal_files) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">validate_files</span>(metal_files, <span class="st">"metal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Validated 2 metal files</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(phys_files) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">validate_files</span>(phys_files, <span class="st">"physical"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Validated 3 physical files</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="data-import-and-initial-processing" class="level3">
<h3 class="anchored" data-anchor-id="data-import-and-initial-processing">Data Import and Initial Processing</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and clean data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(metal_files) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(phys_files) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load real data</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  metals_raw <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(metal_files, <span class="sc">~</span><span class="fu">read_excel</span>(.x) <span class="sc">%&gt;%</span> <span class="fu">clean_names</span>())</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  phys_raw <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(phys_files, <span class="sc">~</span><span class="fu">read_excel</span>(.x) <span class="sc">%&gt;%</span> <span class="fu">clean_names</span>())</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean datasets</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  metals <span class="ot">&lt;-</span> <span class="fu">clean_amd_data</span>(metals_raw, <span class="st">"metals"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  phys <span class="ot">&lt;-</span> <span class="fu">clean_amd_data</span>(phys_raw, <span class="st">"physical"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join datasets</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  amd_raw <span class="ot">&lt;-</span> <span class="fu">left_join</span>(metals, phys, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"site"</span>, <span class="st">"season"</span>, <span class="st">"n"</span>))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create sample data for demonstration</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"⚠ No data files found. Creating sample dataset for demonstration.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  n_samples <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  amd_raw <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">site =</span> <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"Site_"</span>, LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]), <span class="at">each =</span> <span class="dv">15</span>),</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"dry"</span>, <span class="st">"wet"</span>), <span class="at">length.out =</span> n_samples),</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, <span class="dv">8</span>),</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_h =</span> <span class="fu">pmax</span>(<span class="fl">0.5</span>, <span class="fu">pmin</span>(<span class="dv">12</span>, <span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="fl">4.5</span>, <span class="at">sd =</span> <span class="fl">2.5</span>))),</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp_c =</span> <span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="dv">15</span>, <span class="at">sd =</span> <span class="dv">5</span>),</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">cond_s_cm =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="dv">1500</span>, <span class="at">sd =</span> <span class="dv">800</span>)),</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">q_l_s =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="fl">2.5</span>, <span class="at">sd =</span> <span class="fl">1.2</span>)),</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Heavy metals with realistic AMD concentrations</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="dv">45</span>, <span class="at">sd =</span> <span class="dv">25</span>)),</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">mn =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="dv">12</span>, <span class="at">sd =</span> <span class="dv">8</span>)),</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">zn =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="dv">5</span>)),</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">cu =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="fl">3.2</span>, <span class="at">sd =</span> <span class="fl">2.1</span>)),</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">al =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="dv">15</span>, <span class="at">sd =</span> <span class="dv">10</span>)),</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">pb =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="fl">0.8</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)),</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">cd =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="fl">0.15</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)),</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">cr =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="fl">0.05</span>, <span class="at">sd =</span> <span class="fl">0.03</span>)),</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">ni =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="fl">0.25</span>, <span class="at">sd =</span> <span class="fl">0.15</span>)),</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">as =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(n_samples, <span class="at">mean =</span> <span class="fl">0.35</span>, <span class="at">sd =</span> <span class="fl">0.2</span>))</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Cleaned metals : 28 → 28 rows, 15 → 15 columns
✓ Cleaned physical : 56 → 56 rows, 10 → 12 columns</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean the final dataset</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>amd <span class="ot">&lt;-</span> <span class="fu">clean_amd_data</span>(amd_raw, <span class="st">"combined AMD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Cleaned combined AMD : 50 → 50 rows, 24 → 24 columns</code></pre>
</div>
</div>
</section>
</section>
<section id="data-validation-and-column-detection" class="level2">
<h2 class="anchored" data-anchor-id="data-validation-and-column-detection">Data Validation and Column Detection</h2>
<p>This section validates the data structure and identifies available parameters for analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Debug: Check actual column names after cleaning</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== COLUMN NAME VALIDATION ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== COLUMN NAME VALIDATION ===</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Actual column names in cleaned data:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Actual column names in cleaned data:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(amd))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "site"                         "n"                           
 [3] "al"                           "as"                          
 [5] "cd"                           "co"                          
 [7] "cr"                           "cu"                          
 [9] "fe"                           "mn"                          
[11] "ni"                           "pb"                          
[13] "zn"                           "season"                      
[15] "unit"                         "p_h"                         
[17] "do_mg_l"                      "sc_u_s_cm"                   
[19] "low_net_acidity_mg_l_ca_co3"  "high_net_acidity_mg_l_ca_co3"
[21] "sulfate_mg_l"                 "q_l_s"                       
[23] "ph_flag"                      "flow_flag"                   </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect conductivity column</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cond_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(amd)[<span class="fu">grepl</span>(<span class="st">"cond"</span>, <span class="fu">names</span>(amd), <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Conductivity columns found:"</span>, <span class="fu">paste</span>(cond_cols, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Conductivity columns found:  </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine the actual conductivity column name</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(cond_cols) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  actual_cond_col <span class="ot">&lt;-</span> cond_cols[<span class="dv">1</span>]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Using conductivity column:"</span>, actual_cond_col, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fallback options</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  possible_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cond_s_cm"</span>, <span class="st">"conductivity"</span>, <span class="st">"cond"</span>, <span class="st">"ec"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  actual_cond_col <span class="ot">&lt;-</span> <span class="fu">intersect</span>(possible_names, <span class="fu">names</span>(amd))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(actual_cond_col) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    actual_cond_col <span class="ot">&lt;-</span> actual_cond_col[<span class="dv">1</span>]</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Using fallback conductivity column:"</span>, actual_cond_col, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Warning: No conductivity column found. Creating a dummy column.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    amd<span class="sc">$</span>cond_s_cm <span class="ot">&lt;-</span> <span class="dv">1500</span>  <span class="co"># Default value</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    actual_cond_col <span class="ot">&lt;-</span> <span class="st">"cond_s_cm"</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: No conductivity column found. Creating a dummy column.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect flow column</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>flow_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(amd)[<span class="fu">grepl</span>(<span class="st">"q_l_s|flow"</span>, <span class="fu">names</span>(amd), <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Flow columns found:"</span>, <span class="fu">paste</span>(flow_cols, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Flow columns found: q_l_s, flow_flag </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(flow_cols) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  actual_flow_col <span class="ot">&lt;-</span> flow_cols[<span class="dv">1</span>]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Using flow column:"</span>, actual_flow_col, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  possible_flow_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"q_l_s"</span>, <span class="st">"flow"</span>, <span class="st">"discharge"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  actual_flow_col <span class="ot">&lt;-</span> <span class="fu">intersect</span>(possible_flow_names, <span class="fu">names</span>(amd))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(actual_flow_col) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    actual_flow_col <span class="ot">&lt;-</span> actual_flow_col[<span class="dv">1</span>]</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Using fallback flow column:"</span>, actual_flow_col, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Warning: No flow column found. Creating a dummy column.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    amd<span class="sc">$</span>q_l_s <span class="ot">&lt;-</span> <span class="fl">2.5</span>  <span class="co"># Default value</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    actual_flow_col <span class="ot">&lt;-</span> <span class="st">"q_l_s"</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Using flow column: q_l_s </code></pre>
</div>
</div>
<section id="metal-detection-and-regulatory-standards" class="level3">
<h3 class="anchored" data-anchor-id="metal-detection-and-regulatory-standards">Metal Detection and Regulatory Standards</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect metal columns</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>available_metals <span class="ot">&lt;-</span> <span class="fu">detect_metal_columns</span>(amd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Detected 11 metal columns: al, as, cd, co, cr, cu, fe, mn, ni, pb, zn </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add EPA/WHO standards for comparison</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>epa_standards <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">metal =</span> <span class="fu">c</span>(<span class="st">"AL"</span>, <span class="st">"AS"</span>, <span class="st">"CD"</span>, <span class="st">"CR"</span>, <span class="st">"CU"</span>, <span class="st">"FE"</span>, <span class="st">"MN"</span>, <span class="st">"NI"</span>, <span class="st">"PB"</span>, <span class="st">"ZN"</span>),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">drinking_water_mcl =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.01</span>, <span class="fl">0.005</span>, <span class="fl">0.1</span>, <span class="fl">1.3</span>, <span class="fl">0.3</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.015</span>, <span class="dv">5</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">aquatic_life_acute =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.34</span>, <span class="fl">0.002</span>, <span class="fl">0.57</span>, <span class="fl">0.013</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">0.47</span>, <span class="fl">0.065</span>, <span class="fl">0.12</span>),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">aquatic_life_chronic =</span> <span class="fu">c</span>(<span class="fl">0.087</span>, <span class="fl">0.15</span>, <span class="fl">0.00025</span>, <span class="fl">0.074</span>, <span class="fl">0.009</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">0.052</span>, <span class="fl">0.0025</span>, <span class="fl">0.12</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display regulatory standards</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>epa_standards <span class="sc">%&gt;%</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"EPA Regulatory Standards for Water Quality (mg/L)"</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metal"</span>, <span class="st">"Drinking Water MCL"</span>, <span class="st">"Aquatic Life Acute"</span>, <span class="st">"Aquatic Life Chronic"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>EPA Regulatory Standards for Water Quality (mg/L)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Metal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Drinking Water MCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aquatic Life Acute</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aquatic Life Chronic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AL</td>
<td style="text-align: right;">0.200</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.08700</td>
</tr>
<tr class="even">
<td style="text-align: left;">AS</td>
<td style="text-align: right;">0.010</td>
<td style="text-align: right;">0.340</td>
<td style="text-align: right;">0.15000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CD</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.00025</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">0.100</td>
<td style="text-align: right;">0.570</td>
<td style="text-align: right;">0.07400</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CU</td>
<td style="text-align: right;">1.300</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">0.00900</td>
</tr>
<tr class="even">
<td style="text-align: left;">FE</td>
<td style="text-align: right;">0.300</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">1.00000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MN</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">1.00000</td>
</tr>
<tr class="even">
<td style="text-align: left;">NI</td>
<td style="text-align: right;">0.100</td>
<td style="text-align: right;">0.470</td>
<td style="text-align: right;">0.05200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PB</td>
<td style="text-align: right;">0.015</td>
<td style="text-align: right;">0.065</td>
<td style="text-align: right;">0.00250</td>
</tr>
<tr class="even">
<td style="text-align: left;">ZN</td>
<td style="text-align: right;">5.000</td>
<td style="text-align: right;">0.120</td>
<td style="text-align: right;">0.12000</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="data-transformation-and-enhancement" class="level2">
<h2 class="anchored" data-anchor-id="data-transformation-and-enhancement">Data Transformation and Enhancement</h2>
<p>This section creates enhanced variables and categorical classifications for the analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhanced data transformation with dynamic column detection</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>amd_enhanced <span class="ot">&lt;-</span> amd <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Seasonal factor</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">factor</span>(season, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"dry"</span>, <span class="st">"wet"</span>)),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enhanced pH categories</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ph_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>      p_h <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Extremely Acidic (&lt;2)"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>      p_h <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> p_h <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Very Acidic (2-4)"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>      p_h <span class="sc">&gt;=</span> <span class="dv">4</span> <span class="sc">&amp;</span> p_h <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Acidic (4-6)"</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>      p_h <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">&amp;</span> p_h <span class="sc">&lt;</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Slightly Acidic (6-7)"</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>      p_h <span class="sc">&gt;=</span> <span class="dv">7</span> <span class="sc">&amp;</span> p_h <span class="sc">&lt;</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Neutral-Alkaline (7-8)"</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>      p_h <span class="sc">&gt;=</span> <span class="dv">8</span> <span class="sc">&amp;</span> p_h <span class="sc">&lt;</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Alkaline (8-10)"</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>      p_h <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Very Alkaline (&gt;10)"</span>,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unknown"</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">ph_category =</span> <span class="fu">factor</span>(ph_category, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Extremely Acidic (&lt;2)"</span>, <span class="st">"Very Acidic (2-4)"</span>, </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Acidic (4-6)"</span>, <span class="st">"Slightly Acidic (6-7)"</span>,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Neutral-Alkaline (7-8)"</span>, <span class="st">"Alkaline (8-10)"</span>, </span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Very Alkaline (&gt;10)"</span>)),</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Conductivity categories</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">cond_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(actual_cond_col) <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"Low (&lt;500)"</span>,</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(actual_cond_col) <span class="sc">&gt;=</span> <span class="dv">500</span> <span class="sc">&amp;</span> <span class="sc">!!</span><span class="fu">sym</span>(actual_cond_col) <span class="sc">&lt;</span> <span class="dv">1500</span> <span class="sc">~</span> <span class="st">"Medium (500-1500)"</span>,</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(actual_cond_col) <span class="sc">&gt;=</span> <span class="dv">1500</span> <span class="sc">&amp;</span> <span class="sc">!!</span><span class="fu">sym</span>(actual_cond_col) <span class="sc">&lt;</span> <span class="dv">3000</span> <span class="sc">~</span> <span class="st">"High (1500-3000)"</span>,</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(actual_cond_col) <span class="sc">&gt;=</span> <span class="dv">3000</span> <span class="sc">~</span> <span class="st">"Very High (&gt;3000)"</span>,</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unknown"</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flow categories</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">flow_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(actual_flow_col) <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Low (&lt;1 L/s)"</span>,</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(actual_flow_col) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!!</span><span class="fu">sym</span>(actual_flow_col) <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Medium (1-5 L/s)"</span>,</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(actual_flow_col) <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"High (&gt;5 L/s)"</span>,</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unknown"</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Add outlier detection for key parameters</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>key_params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"p_h"</span>, actual_cond_col, actual_flow_col)</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>  key_params <span class="ot">&lt;-</span> <span class="fu">c</span>(key_params, available_metals)</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Only include parameters that actually exist in the dataset</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>existing_params <span class="ot">&lt;-</span> <span class="fu">intersect</span>(key_params, <span class="fu">names</span>(amd_enhanced))</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(existing_params) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>  amd_enhanced <span class="ot">&lt;-</span> <span class="fu">detect_outliers</span>(amd_enhanced, existing_params)</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="create-long-format-data-for-metal-analysis" class="level3">
<h3 class="anchored" data-anchor-id="create-long-format-data-for-metal-analysis">Create Long Format Data for Metal Analysis</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create long format for metal analysis</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  amd_long <span class="ot">&lt;-</span> amd_enhanced <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">all_of</span>(available_metals),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"metal"</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">"conc_mg_l"</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate daily loads (mg/L × L/s × conversion factor)</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">load_kg_d =</span> conc_mg_l <span class="sc">*</span> <span class="sc">!!</span><span class="fu">sym</span>(actual_flow_col) <span class="sc">*</span> <span class="fl">86.4e-6</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Format metal names</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">metal =</span> <span class="fu">factor</span>(<span class="fu">toupper</span>(metal), <span class="at">levels =</span> <span class="fu">toupper</span>(available_metals)),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Log-transformed concentrations for analysis</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">log_conc =</span> <span class="fu">log10</span>(conc_mg_l <span class="sc">+</span> <span class="fl">0.001</span>)  <span class="co"># Add small constant to handle zeros</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(conc_mg_l)) <span class="sc">%&gt;%</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add regulatory comparisons</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(epa_standards, <span class="at">by =</span> <span class="st">"metal"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">exceeds_drinking =</span> conc_mg_l <span class="sc">&gt;</span> drinking_water_mcl,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">exceeds_aquatic_acute =</span> conc_mg_l <span class="sc">&gt;</span> aquatic_life_acute,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">exceeds_aquatic_chronic =</span> conc_mg_l <span class="sc">&gt;</span> aquatic_life_chronic,</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">risk_level =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>        exceeds_drinking <span class="sc">~</span> <span class="st">"High Risk (Exceeds Drinking Water)"</span>,</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>        exceeds_aquatic_acute <span class="sc">~</span> <span class="st">"High Risk (Exceeds Aquatic Acute)"</span>,</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        exceeds_aquatic_chronic <span class="sc">~</span> <span class="st">"Moderate Risk (Exceeds Aquatic Chronic)"</span>,</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Low Risk"</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">risk_level =</span> <span class="fu">factor</span>(risk_level, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low Risk"</span>, <span class="st">"Moderate Risk (Exceeds Aquatic Chronic)"</span>, </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">"High Risk (Exceeds Aquatic Acute)"</span>, <span class="st">"High Risk (Exceeds Drinking Water)"</span>))</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ Created long format data with"</span>, <span class="fu">nrow</span>(amd_long), <span class="st">"metal-sample combinations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Created long format data with 550 metal-sample combinations</code></pre>
</div>
</div>
</section>
</section>
<section id="data-quality-assessment" class="level2">
<h2 class="anchored" data-anchor-id="data-quality-assessment">Data Quality Assessment</h2>
<p>Understanding data completeness and quality is crucial for reliable analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== DATA QUALITY ASSESSMENT ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== DATA QUALITY ASSESSMENT ===</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhanced summary statistics</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>amd_summary <span class="ot">&lt;-</span> <span class="fu">skim</span>(amd_enhanced)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(amd_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>── Data Summary ────────────────────────
                           Values      
Name                       amd_enhanced
Number of rows             50          
Number of columns          42          
_______________________                
Column type frequency:                 
  character                6           
  factor                   2           
  logical                  14          
  numeric                  20          
________________________               
Group variables            None        

── Variable type: character ────────────────────────────────────────────────────
  skim_variable n_missing complete_rate min max empty n_unique whitespace
1 site                  0             1   2   3     0       19          0
2 unit                  0             1   4   4     0        1          0
3 ph_flag               0             1   5   7     0        2          0
4 flow_flag             0             1   5   7     0        2          0
5 cond_category         0             1  16  16     0        1          0
6 flow_category         0             1   7  16     0        3          0

── Variable type: factor ───────────────────────────────────────────────────────
  skim_variable n_missing complete_rate ordered n_unique
1 season                1          0.98 FALSE          2
2 ph_category           6          0.88 FALSE          3
  top_counts                     
1 wet: 30, dry: 19               
2 Ver: 34, Sli: 8, Ext: 2, Aci: 0

── Variable type: logical ──────────────────────────────────────────────────────
   skim_variable     n_missing complete_rate   mean count           
 1 p_h_outlier               6          0.88 0.227  FAL: 34, TRU: 10
 2 cond_s_cm_outlier         0          1    0      FAL: 50         
 3 q_l_s_outlier             6          0.88 0.0909 FAL: 40, TRU: 4 
 4 al_outlier                0          1    0.04   FAL: 48, TRU: 2 
 5 as_outlier                0          1    0.16   FAL: 42, TRU: 8 
 6 cd_outlier                0          1    0.08   FAL: 46, TRU: 4 
 7 co_outlier                0          1    0.08   FAL: 46, TRU: 4 
 8 cr_outlier                0          1    0.16   FAL: 42, TRU: 8 
 9 cu_outlier                0          1    0.16   FAL: 42, TRU: 8 
10 fe_outlier                0          1    0.08   FAL: 46, TRU: 4 
11 mn_outlier                0          1    0.08   FAL: 46, TRU: 4 
12 ni_outlier                0          1    0.08   FAL: 46, TRU: 4 
13 pb_outlier                0          1    0.12   FAL: 44, TRU: 6 
14 zn_outlier                0          1    0.12   FAL: 44, TRU: 6 

── Variable type: numeric ──────────────────────────────────────────────────────
   skim_variable                n_missing complete_rate      mean        sd
 1 n                                    0          1        1.1       0.364
 2 al                                   0          1      652.     1459.   
 3 as                                   0          1       65.8     177.   
 4 cd                                   0          1       13.1      16.6  
 5 co                                   0          1        2.41      3.19 
 6 cr                                   0          1        0.246     0.528
 7 cu                                   0          1       40.5      76.7  
 8 fe                                   0          1     5053.    14049.   
 9 mn                                   0          1       64.9      86.3  
10 ni                                   0          1        2.69      3.15 
11 pb                                   0          1        4.86      8.68 
12 zn                                   0          1     3649.     4636.   
13 p_h                                  6          0.88     3.6       1.58 
14 do_mg_l                              8          0.84     3.49      1.64 
15 sc_u_s_cm                            6          0.88 10794.    11951.   
16 low_net_acidity_mg_l_ca_co3         16          0.68 26999.    40842.   
17 high_net_acidity_mg_l_ca_co3        14          0.72 31723.    54559.   
18 sulfate_mg_l                        22          0.56 21222.    44516.   
19 q_l_s                                6          0.88     0.185     0.258
20 cond_s_cm                            0          1     1500         0    
        p0       p25        p50      p75      p100 hist 
 1    1       1          1          1         3    ▇▁▁▁▁
 2    0.11   35.3      273        648      7480    ▇▁▁▁▁
 3    0       0          8.45      40.7     889    ▇▁▁▁▁
 4    0       0.46       9.42      16.5      65.3  ▇▁▁▁▁
 5    0       0.173      2.02       2.79     14.8  ▇▂▁▁▁
 6    0       0.005      0.0455     0.16      2.51 ▇▁▁▁▁
 7    0       0.178     10.5       30.7     310    ▇▁▁▁▁
 8    0.12   33.1     1875       3240     72100    ▇▁▁▁▁
 9    0.3    10.5       44.9       82.1     402    ▇▂▁▁▁
10    0       0.178      2.08       3.08     11.4  ▇▃▁▁▁
11    0       0.0485     0.86       5.41     34.8  ▇▁▁▁▁
12    0.24   91       2965       4000     19600    ▇▁▁▁▁
13    0.9     3          3.15       3.6       6.9  ▁▇▂▁▂
14    0.1     2.7        3.6        4.08      6.6  ▂▂▇▂▃
15  272    2710       8960      14900     54600    ▇▂▁▁▁
16 1020    9160      16300      25200    181000    ▇▁▁▁▁
17   83.2  9870      16600      30100    246000    ▇▁▁▁▁
18  232     498       8730      19300    175000    ▇▁▁▁▁
19    0.01    0.03       0.085      0.26      1.1  ▇▂▁▁▁
20 1500    1500       1500       1500      1500    ▁▁▇▁▁</code></pre>
</div>
</div>
<section id="missing-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="missing-data-analysis">Missing Data Analysis</h3>
</section>
<section id="missing-data-visualization" class="level3">
<h3 class="anchored" data-anchor-id="missing-data-visualization">Missing Data Visualization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize missing data patterns</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>p_missing <span class="ot">&lt;-</span> <span class="fu">vis_miss</span>(amd_enhanced, <span class="at">cluster =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Missing Data Patterns in Enhanced AMD Dataset"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Clustered by missing data patterns"</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_missing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strosnider_2011_06_files/figure-html/missing-data-viz-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-quality-summary" class="level3">
<h3 class="anchored" data-anchor-id="data-quality-summary">Data Quality Summary</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data quality flags summary</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"ph_flag"</span> <span class="sc">%in%</span> <span class="fu">names</span>(amd_enhanced)) {</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  quality_summary <span class="ot">&lt;-</span> amd_enhanced <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_samples =</span> <span class="fu">n</span>(),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">ph_valid =</span> <span class="fu">sum</span>(ph_flag <span class="sc">==</span> <span class="st">"valid"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">ph_missing =</span> <span class="fu">sum</span>(ph_flag <span class="sc">==</span> <span class="st">"missing"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">ph_out_of_range =</span> <span class="fu">sum</span>(ph_flag <span class="sc">==</span> <span class="st">"out_of_range"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Data Quality Summary:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"• Total samples:"</span>, quality_summary<span class="sc">$</span>total_samples, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"• Valid pH measurements:"</span>, quality_summary<span class="sc">$</span>ph_valid, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"• Missing pH:"</span>, quality_summary<span class="sc">$</span>ph_missing, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"• Out-of-range pH:"</span>, quality_summary<span class="sc">$</span>ph_out_of_range, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data Quality Summary:
• Total samples: 50 
• Valid pH measurements: 44 
• Missing pH: 6 
• Out-of-range pH: 0 </code></pre>
</div>
</div>
</section>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<section id="ph-analysis" class="level3">
<h3 class="anchored" data-anchor-id="ph-analysis">pH Analysis</h3>
<p>pH is a critical parameter in acid mine drainage, controlling metal mobility and bioavailability.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprehensive pH Analysis</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>p_ph_comprehensive <span class="ot">&lt;-</span> amd_enhanced <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(site, p_h), <span class="at">y =</span> p_h)) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> season), <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">outlier.shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">10</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">name =</span> <span class="st">"Season"</span>) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Site (ordered by median pH)"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"pH"</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comprehensive pH Analysis by Site and Season"</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Dashed lines indicate pH category boundaries"</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"Extremely</span><span class="sc">\n</span><span class="st">Acidic"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">3</span>, <span class="at">label =</span> <span class="st">"Very</span><span class="sc">\n</span><span class="st">Acidic"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">5</span>, <span class="at">label =</span> <span class="st">"Acidic"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="fl">7.5</span>, <span class="at">label =</span> <span class="st">"Neutral"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_ph_comprehensive)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strosnider_2011_06_files/figure-html/ph-analysis-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="metal-concentration-analysis" class="level3">
<h3 class="anchored" data-anchor-id="metal-concentration-analysis">Metal Concentration Analysis</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhanced Metal Concentration Analysis</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>)) {</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Statistical summary by metal</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  metal_stats <span class="ot">&lt;-</span> amd_long <span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_obs =</span> <span class="fu">n</span>(),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_conc =</span> <span class="fu">mean</span>(conc_mg_l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_conc =</span> <span class="fu">median</span>(conc_mg_l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">q75_conc =</span> <span class="fu">quantile</span>(conc_mg_l, <span class="fl">0.75</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_conc =</span> <span class="fu">max</span>(conc_mg_l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">cv =</span> <span class="fu">sd</span>(conc_mg_l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> mean_conc,</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_above_drinking =</span> <span class="fu">sum</span>(exceeds_drinking, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_above_aquatic =</span> <span class="fu">sum</span>(exceeds_aquatic_acute, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_conc))</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display enhanced metal statistics</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  metal_stats <span class="sc">%&gt;%</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Enhanced Metal Concentration Statistics with Regulatory Exceedances"</span>,</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metal"</span>, <span class="st">"N Obs"</span>, <span class="st">"Mean (mg/L)"</span>, <span class="st">"Median (mg/L)"</span>, <span class="st">"Q75 (mg/L)"</span>,</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Max (mg/L)"</span>, <span class="st">"CV"</span>, <span class="st">"Above Drinking Std"</span>, <span class="st">"Above Aquatic Std"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">8</span>, <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">background =</span> <span class="fu">spec_color</span>(metal_stats<span class="sc">$</span>n_above_drinking, <span class="at">option =</span> <span class="st">"plasma"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">9</span>, <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>                <span class="at">background =</span> <span class="fu">spec_color</span>(metal_stats<span class="sc">$</span>n_above_aquatic, <span class="at">option =</span> <span class="st">"plasma"</span>))</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Enhanced Metal Concentration Statistics with Regulatory Exceedances</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Metal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Obs</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean (mg/L)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Median (mg/L)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Q75 (mg/L)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Max (mg/L)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CV</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Above Drinking Std</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Above Aquatic Std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FE</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">5053.490</td>
<td style="text-align: right;">1875.000</td>
<td style="text-align: right;">3240.00</td>
<td style="text-align: right;">72100.00</td>
<td style="text-align: right;">2.780</td>
<td style="text-align: right; color: white !important; background-color: rgba(253, 181, 46, 255) !important;">42</td>
<td style="text-align: right; color: white !important; background-color: rgba(253, 174, 50, 255) !important;">41</td>
</tr>
<tr class="even">
<td style="text-align: left;">ZN</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">3649.292</td>
<td style="text-align: right;">2965.000</td>
<td style="text-align: right;">4000.00</td>
<td style="text-align: right;">19600.00</td>
<td style="text-align: right;">1.270</td>
<td style="text-align: right; color: white !important; background-color: rgba(253, 197, 39, 255) !important;">44</td>
<td style="text-align: right; color: white !important; background-color: rgba(240, 249, 33, 255) !important;">50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AL</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">652.256</td>
<td style="text-align: right;">273.000</td>
<td style="text-align: right;">648.00</td>
<td style="text-align: right;">7480.00</td>
<td style="text-align: right;">2.238</td>
<td style="text-align: right; color: white !important; background-color: rgba(246, 232, 38, 255) !important;">48</td>
<td style="text-align: right; color: white !important; background-color: rgba(253, 197, 39, 255) !important;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">AS</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">65.828</td>
<td style="text-align: right;">8.450</td>
<td style="text-align: right;">40.70</td>
<td style="text-align: right;">889.00</td>
<td style="text-align: right;">2.681</td>
<td style="text-align: right; color: white !important; background-color: rgba(242, 132, 75, 255) !important;">35</td>
<td style="text-align: right; color: white !important; background-color: rgba(239, 124, 81, 255) !important;">34</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MN</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">64.903</td>
<td style="text-align: right;">44.900</td>
<td style="text-align: right;">82.15</td>
<td style="text-align: right;">402.00</td>
<td style="text-align: right;">1.330</td>
<td style="text-align: right; color: white !important; background-color: rgba(240, 249, 33, 255) !important;">50</td>
<td style="text-align: right; color: white !important; background-color: rgba(253, 197, 39, 255) !important;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">CU</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">40.540</td>
<td style="text-align: right;">10.500</td>
<td style="text-align: right;">30.70</td>
<td style="text-align: right;">310.00</td>
<td style="text-align: right;">1.892</td>
<td style="text-align: right; color: white !important; background-color: rgba(232, 112, 89, 255) !important;">32</td>
<td style="text-align: right; color: white !important; background-color: rgba(253, 197, 39, 255) !important;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CD</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">13.131</td>
<td style="text-align: right;">9.420</td>
<td style="text-align: right;">16.50</td>
<td style="text-align: right;">65.30</td>
<td style="text-align: right;">1.266</td>
<td style="text-align: right; color: white !important; background-color: rgba(251, 215, 36, 255) !important;">46</td>
<td style="text-align: right; color: white !important; background-color: rgba(251, 215, 36, 255) !important;">46</td>
</tr>
<tr class="even">
<td style="text-align: left;">PB</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">4.858</td>
<td style="text-align: right;">0.860</td>
<td style="text-align: right;">5.41</td>
<td style="text-align: right;">34.80</td>
<td style="text-align: right;">1.787</td>
<td style="text-align: right; color: white !important; background-color: rgba(253, 197, 39, 255) !important;">44</td>
<td style="text-align: right; color: white !important; background-color: rgba(245, 139, 71, 255) !important;">36</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NI</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">2.688</td>
<td style="text-align: right;">2.080</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">11.40</td>
<td style="text-align: right;">1.173</td>
<td style="text-align: right; color: white !important; background-color: rgba(249, 152, 62, 255) !important;">38</td>
<td style="text-align: right; color: white !important; background-color: rgba(235, 118, 85, 255) !important;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">CO</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">2.407</td>
<td style="text-align: right;">2.020</td>
<td style="text-align: right;">2.79</td>
<td style="text-align: right;">14.80</td>
<td style="text-align: right;">1.324</td>
<td style="text-align: right; color: white !important; background-color: rgba(13, 8, 135, 255) !important;">0</td>
<td style="text-align: right; color: white !important; background-color: rgba(13, 8, 135, 255) !important;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.246</td>
<td style="text-align: right;">0.046</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">2.51</td>
<td style="text-align: right;">2.144</td>
<td style="text-align: right; color: white !important; background-color: rgba(188, 53, 135, 255) !important;">22</td>
<td style="text-align: right; color: white !important; background-color: rgba(75, 3, 161, 255) !important;">6</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="metal-concentration-visualization" class="level3">
<h3 class="anchored" data-anchor-id="metal-concentration-visualization">Metal Concentration Visualization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>)) {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Enhanced metal concentration visualization</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  p_metals_enhanced <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(amd_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(metal, conc_mg_l), <span class="at">y =</span> conc_mg_l)) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> risk_level), <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">outlier.shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Low Risk"</span> <span class="ot">=</span> <span class="st">"#2E8B57"</span>, </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Moderate Risk (Exceeds Aquatic Chronic)"</span> <span class="ot">=</span> <span class="st">"#DAA520"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"High Risk (Exceeds Aquatic Acute)"</span> <span class="ot">=</span> <span class="st">"#FF6347"</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"High Risk (Exceeds Drinking Water)"</span> <span class="ot">=</span> <span class="st">"#DC143C"</span>)) <span class="sc">+</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Metal"</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Concentration (mg/L, log scale)"</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Metal Concentrations with Regulatory Risk Assessment"</span>,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Colors indicate risk level based on EPA standards"</span>,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"Risk Level"</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p_metals_enhanced)</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strosnider_2011_06_files/figure-html/metal-viz-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="seasonal-analysis" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-analysis">Seasonal Analysis</h2>
<section id="statistical-comparison-between-seasons" class="level3">
<h3 class="anchored" data-anchor-id="statistical-comparison-between-seasons">Statistical Comparison Between Seasons</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>)) {</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Advanced Seasonal Comparison with Statistics</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  seasonal_tests <span class="ot">&lt;-</span> <span class="fu">compare_seasons</span>(amd_long, <span class="st">"conc_mg_l"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(seasonal_tests)) {</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display statistical test results</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    seasonal_tests <span class="sc">%&gt;%</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value)) <span class="sc">%&gt;%</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(p_value) <span class="sc">%&gt;%</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Seasonal Comparison Statistical Results (Wilcoxon Rank-Sum Tests)"</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metal"</span>, <span class="st">"N Dry"</span>, <span class="st">"N Wet"</span>, <span class="st">"Median Dry"</span>, <span class="st">"Median Wet"</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"P-value"</span>, <span class="st">"Fold Change"</span>, <span class="st">"Adj P-value"</span>, <span class="st">"Significant"</span>, <span class="st">"Interpretation"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">column_spec</span>(<span class="dv">9</span>, <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">background =</span> <span class="fu">ifelse</span>(seasonal_tests<span class="sc">$</span>significant[<span class="sc">!</span><span class="fu">is.na</span>(seasonal_tests<span class="sc">$</span>p_value)], </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"#228B22"</span>, <span class="st">"#696969"</span>))</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Seasonal Comparison Statistical Results (Wilcoxon Rank-Sum Tests)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Metal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Dry</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Wet</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Median Dry</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Median Wet</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">P-value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Fold Change</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Adj P-value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Significant</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ZN</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">4000.00</td>
<td style="text-align: right;">1.66e+03</td>
<td style="text-align: right;">0.0575</td>
<td style="text-align: right;">0.4150</td>
<td style="text-align: right;">0.633</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
<tr class="even">
<td style="text-align: left;">CD</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">12.40</td>
<td style="text-align: right;">9.42e+00</td>
<td style="text-align: right;">0.1116</td>
<td style="text-align: right;">0.7597</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CO</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">2.51</td>
<td style="text-align: right;">1.35e+00</td>
<td style="text-align: right;">0.1358</td>
<td style="text-align: right;">0.5378</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
<tr class="even">
<td style="text-align: left;">AL</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">461.00</td>
<td style="text-align: right;">2.11e+02</td>
<td style="text-align: right;">0.2811</td>
<td style="text-align: right;">0.4577</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NI</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">2.55</td>
<td style="text-align: right;">2.08e+00</td>
<td style="text-align: right;">0.3941</td>
<td style="text-align: right;">0.8157</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
<tr class="even">
<td style="text-align: left;">FE</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">2580.00</td>
<td style="text-align: right;">1.75e+03</td>
<td style="text-align: right;">0.4057</td>
<td style="text-align: right;">0.6783</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MN</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">48.50</td>
<td style="text-align: right;">4.14e+01</td>
<td style="text-align: right;">0.5864</td>
<td style="text-align: right;">0.8536</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
<tr class="even">
<td style="text-align: left;">PB</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: right;">1.46e+00</td>
<td style="text-align: right;">0.6292</td>
<td style="text-align: right;">2.2812</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CU</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">10.80</td>
<td style="text-align: right;">5.91e+00</td>
<td style="text-align: right;">0.8613</td>
<td style="text-align: right;">0.5472</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">4.55e-02</td>
<td style="text-align: right;">0.9590</td>
<td style="text-align: right;">0.5056</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AS</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">13.60</td>
<td style="text-align: right;">8.45e+00</td>
<td style="text-align: right;">0.9751</td>
<td style="text-align: right;">0.6213</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">FALSE</td>
<td style="text-align: left;">No significant difference</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
</section>
<section id="seasonal-differences-visualization" class="level3">
<h3 class="anchored" data-anchor-id="seasonal-differences-visualization">Seasonal Differences Visualization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>) <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"metal_stats"</span>)) {</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualize seasonal differences</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  high_conc_metals <span class="ot">&lt;-</span> metal_stats <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(mean_conc, <span class="at">n =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(metal)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  p_seasonal_metals <span class="ot">&lt;-</span> amd_long <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(metal <span class="sc">%in%</span> high_conc_metals) <span class="sc">%&gt;%</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> conc_mg_l, <span class="at">fill =</span> season)) <span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">outlier.shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"D"</span>, <span class="at">name =</span> <span class="st">"Season"</span>) <span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>metal, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Season"</span>,</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Concentration (mg/L, log scale)"</span>,</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Seasonal Variations in Top 8 Metal Concentrations"</span>,</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Boxplots show median, quartiles, and outliers"</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p_seasonal_metals)</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strosnider_2011_06_files/figure-html/seasonal-viz-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="seasonal-ph-and-physical-parameters" class="level3">
<h3 class="anchored" data-anchor-id="seasonal-ph-and-physical-parameters">Seasonal pH and Physical Parameters</h3>
</section>
</section>
<section id="site-specific-analysis" class="level2">
<h2 class="anchored" data-anchor-id="site-specific-analysis">Site-Specific Analysis</h2>
<section id="site-characterization" class="level3">
<h3 class="anchored" data-anchor-id="site-characterization">Site Characterization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Site characterization analysis</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>site_summary <span class="ot">&lt;-</span> amd_enhanced <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_samples =</span> <span class="fu">n</span>(),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_ph =</span> <span class="fu">mean</span>(p_h, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_ph =</span> <span class="fu">median</span>(p_h, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_cond =</span> <span class="fu">mean</span>(<span class="sc">!!</span><span class="fu">sym</span>(actual_cond_col), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_flow =</span> <span class="fu">mean</span>(<span class="sc">!!</span><span class="fu">sym</span>(actual_flow_col), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ph_range =</span> <span class="fu">max</span>(p_h, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(p_h, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">dominant_ph_category =</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">table</span>(ph_category), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span>],</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">site_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>      mean_ph <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Highly Acidic"</span>,</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>      mean_ph <span class="sc">&gt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> mean_ph <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Acidic"</span>,</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>      mean_ph <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> mean_ph <span class="sc">&lt;</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Moderately Acidic"</span>,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>      mean_ph <span class="sc">&gt;=</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Neutral-Alkaline"</span>,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Variable"</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean_ph)</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display site summary</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>site_summary <span class="sc">%&gt;%</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Site Characterization Summary"</span>,</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Site"</span>, <span class="st">"N Samples"</span>, <span class="st">"Mean pH"</span>, <span class="st">"Median pH"</span>, <span class="st">"Mean Conductivity"</span>,</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Mean Flow"</span>, <span class="st">"pH Range"</span>, <span class="st">"Dominant pH Category"</span>, <span class="st">"Site Type"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">9</span>, <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">background =</span> <span class="fu">case_when</span>(</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>                site_summary<span class="sc">$</span>site_type <span class="sc">==</span> <span class="st">"Highly Acidic"</span> <span class="sc">~</span> <span class="st">"#8B0000"</span>,</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>                site_summary<span class="sc">$</span>site_type <span class="sc">==</span> <span class="st">"Acidic"</span> <span class="sc">~</span> <span class="st">"#DC143C"</span>,</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>                site_summary<span class="sc">$</span>site_type <span class="sc">==</span> <span class="st">"Moderately Acidic"</span> <span class="sc">~</span> <span class="st">"#DAA520"</span>,</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>                site_summary<span class="sc">$</span>site_type <span class="sc">==</span> <span class="st">"Neutral-Alkaline"</span> <span class="sc">~</span> <span class="st">"#228B22"</span>,</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>                <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#696969"</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>              ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Site Characterization Summary</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Site</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Samples</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean pH</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Median pH</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean Conductivity</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean Flow</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pH Range</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Dominant pH Category</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Site Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">4T</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: left;">Extremely Acidic (&lt;2)</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Highly Acidic</td>
</tr>
<tr class="even">
<td style="text-align: left;">7C</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.10</td>
<td style="text-align: right;">2.10</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: left;">Very Acidic (2-4)</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Highly Acidic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.30</td>
<td style="text-align: right;">2.30</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: left;">Very Acidic (2-4)</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Highly Acidic</td>
</tr>
<tr class="even">
<td style="text-align: left;">5C</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2.95</td>
<td style="text-align: right;">2.95</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.9</td>
<td style="text-align: left;">Very Acidic (2-4)</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Highly Acidic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1T</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: left;">Very Acidic (2-4)</td>
<td style="text-align: left; color: white !important; background-color: rgba(220, 20, 60, 255) !important;">Acidic</td>
</tr>
<tr class="even">
<td style="text-align: left;">1C</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">Very Acidic (2-4)</td>
<td style="text-align: left; color: white !important; background-color: rgba(220, 20, 60, 255) !important;">Acidic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2T</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">1.10</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: left;">Very Acidic (2-4)</td>
<td style="text-align: left; color: white !important; background-color: rgba(220, 20, 60, 255) !important;">Acidic</td>
</tr>
<tr class="even">
<td style="text-align: left;">3C</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">Very Acidic (2-4)</td>
<td style="text-align: left; color: white !important; background-color: rgba(220, 20, 60, 255) !important;">Acidic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2C</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3.20</td>
<td style="text-align: right;">3.20</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">Very Acidic (2-4)</td>
<td style="text-align: left; color: white !important; background-color: rgba(220, 20, 60, 255) !important;">Acidic</td>
</tr>
<tr class="even">
<td style="text-align: left;">3A</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.6</td>
<td style="text-align: left;">Very Acidic (2-4)</td>
<td style="text-align: left; color: white !important; background-color: rgba(220, 20, 60, 255) !important;">Acidic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4C</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3.40</td>
<td style="text-align: right;">3.40</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: left;">Very Acidic (2-4)</td>
<td style="text-align: left; color: white !important; background-color: rgba(220, 20, 60, 255) !important;">Acidic</td>
</tr>
<tr class="even">
<td style="text-align: left;">3T</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6.45</td>
<td style="text-align: right;">6.45</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: left;">Slightly Acidic (6-7)</td>
<td style="text-align: left; color: white !important; background-color: rgba(218, 165, 32, 255) !important;">Moderately Acidic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6.90</td>
<td style="text-align: right;">6.90</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: left;">Slightly Acidic (6-7)</td>
<td style="text-align: left; color: white !important; background-color: rgba(218, 165, 32, 255) !important;">Moderately Acidic</td>
</tr>
<tr class="even">
<td style="text-align: left;">5A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6.90</td>
<td style="text-align: right;">6.90</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: left;">Slightly Acidic (6-7)</td>
<td style="text-align: left; color: white !important; background-color: rgba(218, 165, 32, 255) !important;">Moderately Acidic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1Aa</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: left;">Extremely Acidic (&lt;2)</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">Variable</td>
</tr>
<tr class="even">
<td style="text-align: left;">1Ab</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: left;">Extremely Acidic (&lt;2)</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">Variable</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2Ab</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: left;">Extremely Acidic (&lt;2)</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">Variable</td>
</tr>
<tr class="even">
<td style="text-align: left;">6C</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: left;">Extremely Acidic (&lt;2)</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">Variable</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6Cb</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: left;">Extremely Acidic (&lt;2)</td>
<td style="text-align: left; color: white !important; background-color: rgba(105, 105, 105, 255) !important;">Variable</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="site-comparison-visualization" class="level3">
<h3 class="anchored" data-anchor-id="site-comparison-visualization">Site Comparison Visualization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Site comparison radar chart data preparation</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>)) {</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  site_metal_summary <span class="ot">&lt;-</span> amd_long <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(site, metal) <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_conc =</span> <span class="fu">mean</span>(conc_mg_l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_conc =</span> <span class="fu">median</span>(conc_mg_l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize by metal to compare relative patterns</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">normalized_conc =</span> (mean_conc <span class="sc">-</span> <span class="fu">min</span>(mean_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>                       (<span class="fu">max</span>(mean_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(mean_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Heatmap of site-metal concentrations</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  p_site_heatmap <span class="ot">&lt;-</span> site_metal_summary <span class="sc">%&gt;%</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(normalized_conc)) <span class="sc">%&gt;%</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> metal, <span class="at">y =</span> <span class="fu">reorder</span>(site, <span class="sc">-</span>normalized_conc), <span class="at">fill =</span> normalized_conc)) <span class="sc">+</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">name =</span> <span class="st">"Normalized</span><span class="sc">\n</span><span class="st">Concentration"</span>) <span class="sc">+</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Metal"</span>,</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Site"</span>,</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Site-Metal Concentration Patterns"</span>,</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Normalized concentrations (0-1 scale within each metal)"</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p_site_heatmap)</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strosnider_2011_06_files/figure-html/site-viz-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="correlation-analysis" class="level2">
<h2 class="anchored" data-anchor-id="correlation-analysis">Correlation Analysis</h2>
<section id="metal-metal-correlations" class="level3">
<h3 class="anchored" data-anchor-id="metal-metal-correlations">Metal-Metal Correlations</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate correlation matrix</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  metal_cor_data <span class="ot">&lt;-</span> amd_enhanced <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(available_metals)) <span class="sc">%&gt;%</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Enhanced correlation plot</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corrplot</span>(metal_cor_data, </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"color"</span>, </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">order =</span> <span class="st">"hclust"</span>,</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">tl.cex =</span> <span class="fl">0.8</span>,</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">tl.col =</span> <span class="st">"black"</span>,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">tl.srt =</span> <span class="dv">45</span>,</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">addCoef.col =</span> <span class="st">"black"</span>,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">number.cex =</span> <span class="fl">0.7</span>,</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="st">"Metal-Metal Correlation Matrix"</span>,</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strosnider_2011_06_files/figure-html/correlation-analysis-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ph-metal-relationships" class="level3">
<h3 class="anchored" data-anchor-id="ph-metal-relationships">pH-Metal Relationships</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>)) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pH-metal relationship analysis</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  ph_metal_cor <span class="ot">&lt;-</span> amd_long <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">correlation =</span> <span class="fu">cor</span>(p_h, conc_mg_l, <span class="at">use =</span> <span class="st">"complete.obs"</span>),</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value =</span> <span class="fu">cor.test</span>(p_h, conc_mg_l)<span class="sc">$</span>p.value,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_obs =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_h) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(conc_mg_l)),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">significance =</span> <span class="fu">case_when</span>(</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        p_value <span class="sc">&lt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"***"</span>,</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>        p_value <span class="sc">&lt;</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">"**"</span>,</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>        p_value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"*"</span>,</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"ns"</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">correlation_strength =</span> <span class="fu">case_when</span>(</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">abs</span>(correlation) <span class="sc">&gt;</span> <span class="fl">0.7</span> <span class="sc">~</span> <span class="st">"Strong"</span>,</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">abs</span>(correlation) <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">"Moderate"</span>,</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">abs</span>(correlation) <span class="sc">&gt;</span> <span class="fl">0.3</span> <span class="sc">~</span> <span class="st">"Weak"</span>,</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Very Weak"</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(correlation)</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display pH-metal correlations</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  ph_metal_cor <span class="sc">%&gt;%</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"pH-Metal Concentration Correlations"</span>,</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metal"</span>, <span class="st">"Correlation"</span>, <span class="st">"P-value"</span>, <span class="st">"N Obs"</span>, <span class="st">"Significance"</span>, <span class="st">"Strength"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">2</span>, <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">background =</span> <span class="fu">spec_color</span>(ph_metal_cor<span class="sc">$</span>correlation, <span class="at">option =</span> <span class="st">"RdBu"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>pH-Metal Concentration Correlations</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Metal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Correlation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">P-value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Obs</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Significance</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Strength</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CO</td>
<td style="text-align: right; color: white !important; background-color: rgba(253, 231, 37, 255) !important;">-0.577</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">***</td>
<td style="text-align: left;">Moderate</td>
</tr>
<tr class="even">
<td style="text-align: left;">CU</td>
<td style="text-align: right; color: white !important; background-color: rgba(155, 217, 60, 255) !important;">-0.536</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">***</td>
<td style="text-align: left;">Moderate</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NI</td>
<td style="text-align: right; color: white !important; background-color: rgba(147, 215, 65, 255) !important;">-0.532</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">***</td>
<td style="text-align: left;">Moderate</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right; color: white !important; background-color: rgba(99, 203, 95, 255) !important;">-0.510</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">***</td>
<td style="text-align: left;">Moderate</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AL</td>
<td style="text-align: right; color: white !important; background-color: rgba(76, 194, 108, 255) !important;">-0.498</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">***</td>
<td style="text-align: left;">Weak</td>
</tr>
<tr class="even">
<td style="text-align: left;">AS</td>
<td style="text-align: right; color: white !important; background-color: rgba(42, 176, 127, 255) !important;">-0.474</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">**</td>
<td style="text-align: left;">Weak</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FE</td>
<td style="text-align: right; color: white !important; background-color: rgba(31, 161, 135, 255) !important;">-0.457</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">**</td>
<td style="text-align: left;">Weak</td>
</tr>
<tr class="even">
<td style="text-align: left;">CD</td>
<td style="text-align: right; color: white !important; background-color: rgba(53, 94, 141, 255) !important;">-0.378</td>
<td style="text-align: right;">0.011</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;">Weak</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PB</td>
<td style="text-align: right; color: white !important; background-color: rgba(55, 90, 140, 255) !important;">-0.373</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;">Weak</td>
</tr>
<tr class="even">
<td style="text-align: left;">ZN</td>
<td style="text-align: right; color: white !important; background-color: rgba(72, 36, 117, 255) !important;">-0.322</td>
<td style="text-align: right;">0.033</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;">Weak</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MN</td>
<td style="text-align: right; color: white !important; background-color: rgba(68, 1, 84, 255) !important;">-0.295</td>
<td style="text-align: right;">0.052</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">ns</td>
<td style="text-align: left;">Very Weak</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="scatter-plot-matrix" class="level3">
<h3 class="anchored" data-anchor-id="scatter-plot-matrix">Scatter Plot Matrix</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>)) {</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select top metals for scatter plot analysis</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  top_metals <span class="ot">&lt;-</span> metal_stats <span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(mean_conc, <span class="at">n =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(metal)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create scatter plot showing pH relationships</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  p_ph_scatter <span class="ot">&lt;-</span> amd_long <span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(metal <span class="sc">%in%</span> top_metals) <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_h, <span class="at">y =</span> conc_mg_l, <span class="at">color =</span> season)) <span class="sc">+</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"D"</span>, <span class="at">name =</span> <span class="st">"Season"</span>) <span class="sc">+</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>metal, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"pH"</span>,</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Concentration (mg/L, log scale)"</span>,</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"pH vs Metal Concentration Relationships"</span>,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Linear regression lines with 95% confidence intervals"</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p_ph_scatter)</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strosnider_2011_06_files/figure-html/scatter-matrix-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="environmental-risk-assessment" class="level2">
<h2 class="anchored" data-anchor-id="environmental-risk-assessment">Environmental Risk Assessment</h2>
<section id="regulatory-compliance-analysis" class="level3">
<h3 class="anchored" data-anchor-id="regulatory-compliance-analysis">Regulatory Compliance Analysis</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>)) {</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Comprehensive risk assessment</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  risk_summary <span class="ot">&lt;-</span> amd_long <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_samples =</span> <span class="fu">n</span>(),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">exceed_drinking_n =</span> <span class="fu">sum</span>(exceeds_drinking, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">exceed_drinking_pct =</span> <span class="fu">round</span>(exceed_drinking_n <span class="sc">/</span> n_samples <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">exceed_aquatic_acute_n =</span> <span class="fu">sum</span>(exceeds_aquatic_acute, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">exceed_aquatic_acute_pct =</span> <span class="fu">round</span>(exceed_aquatic_acute_n <span class="sc">/</span> n_samples <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">exceed_aquatic_chronic_n =</span> <span class="fu">sum</span>(exceeds_aquatic_chronic, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">exceed_aquatic_chronic_pct =</span> <span class="fu">round</span>(exceed_aquatic_chronic_n <span class="sc">/</span> n_samples <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_exceedance_drinking =</span> <span class="fu">max</span>(conc_mg_l <span class="sc">/</span> drinking_water_mcl, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_exceedance_aquatic =</span> <span class="fu">max</span>(conc_mg_l <span class="sc">/</span> aquatic_life_acute, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">overall_risk =</span> <span class="fu">case_when</span>(</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>        exceed_drinking_pct <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"Critical"</span>,</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>        exceed_aquatic_acute_pct <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>        exceed_aquatic_chronic_pct <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"Moderate"</span>,</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>        exceed_aquatic_chronic_pct <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Minimal"</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(exceed_drinking_pct))</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display risk assessment</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>  risk_summary <span class="sc">%&gt;%</span></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>max_exceedance_drinking, <span class="sc">-</span>max_exceedance_aquatic) <span class="sc">%&gt;%</span></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Environmental Risk Assessment Summary"</span>,</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metal"</span>, <span class="st">"N Samples"</span>, <span class="st">"Exceed Drinking (n)"</span>, <span class="st">"Exceed Drinking (%)"</span>,</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Exceed Aquatic Acute (n)"</span>, <span class="st">"Exceed Aquatic Acute (%)"</span>,</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Exceed Aquatic Chronic (n)"</span>, <span class="st">"Exceed Aquatic Chronic (%)"</span>, <span class="st">"Risk Level"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">9</span>, <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">background =</span> <span class="fu">case_when</span>(</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>                  risk_summary<span class="sc">$</span>overall_risk <span class="sc">==</span> <span class="st">"Critical"</span> <span class="sc">~</span> <span class="st">"#8B0000"</span>,</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>                  risk_summary<span class="sc">$</span>overall_risk <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">~</span> <span class="st">"#DC143C"</span>,</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>                  risk_summary<span class="sc">$</span>overall_risk <span class="sc">==</span> <span class="st">"Moderate"</span> <span class="sc">~</span> <span class="st">"#DAA520"</span>,</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>                  risk_summary<span class="sc">$</span>overall_risk <span class="sc">==</span> <span class="st">"Low"</span> <span class="sc">~</span> <span class="st">"#228B22"</span>,</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>                  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#2E8B57"</span></span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>                ))</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Environmental Risk Assessment Summary</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Metal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Samples</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Exceed Drinking (n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Exceed Drinking (%)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Exceed Aquatic Acute (n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Exceed Aquatic Acute (%)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Exceed Aquatic Chronic (n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Exceed Aquatic Chronic (%)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Risk Level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">MN</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">88</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Critical</td>
</tr>
<tr class="even">
<td style="text-align: left;">AL</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">100</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Critical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CD</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">96</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Critical</td>
</tr>
<tr class="even">
<td style="text-align: left;">PB</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">88</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Critical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ZN</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">100</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Critical</td>
</tr>
<tr class="even">
<td style="text-align: left;">FE</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">82</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Critical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NI</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">84</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Critical</td>
</tr>
<tr class="even">
<td style="text-align: left;">AS</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">68</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Critical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CU</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">88</td>
<td style="text-align: left; color: white !important; background-color: rgba(139, 0, 0, 255) !important;">Critical</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">48</td>
<td style="text-align: left; color: white !important; background-color: rgba(34, 139, 34, 255) !important;">Low</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CO</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left; color: white !important; background-color: rgba(46, 139, 87, 255) !important;">Minimal</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="risk-visualization" class="level3">
<h3 class="anchored" data-anchor-id="risk-visualization">Risk Visualization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>)) {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Risk level distribution</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  p_risk_dist <span class="ot">&lt;-</span> amd_long <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(metal, risk_level) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">percentage =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(metal, <span class="sc">-</span>percentage), <span class="at">y =</span> percentage, <span class="at">fill =</span> risk_level)) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Low Risk"</span> <span class="ot">=</span> <span class="st">"#2E8B57"</span>, </span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Moderate Risk (Exceeds Aquatic Chronic)"</span> <span class="ot">=</span> <span class="st">"#DAA520"</span>,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"High Risk (Exceeds Aquatic Acute)"</span> <span class="ot">=</span> <span class="st">"#FF6347"</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"High Risk (Exceeds Drinking Water)"</span> <span class="ot">=</span> <span class="st">"#DC143C"</span>)) <span class="sc">+</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Metal"</span>,</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Percentage of Samples"</span>,</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Risk Level Distribution by Metal"</span>,</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Based on EPA regulatory standards"</span>,</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"Risk Level"</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p_risk_dist)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strosnider_2011_06_files/figure-html/risk-viz-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="load-calculations-and-environmental-impact" class="level2">
<h2 class="anchored" data-anchor-id="load-calculations-and-environmental-impact">Load Calculations and Environmental Impact</h2>
<section id="metal-loading-analysis" class="level3">
<h3 class="anchored" data-anchor-id="metal-loading-analysis">Metal Loading Analysis</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>)) {</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Metal loading calculations</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  load_summary <span class="ot">&lt;-</span> amd_long <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(metal, season) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_samples =</span> <span class="fu">n</span>(),</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_conc =</span> <span class="fu">mean</span>(conc_mg_l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_flow =</span> <span class="fu">mean</span>(<span class="sc">!!</span><span class="fu">sym</span>(actual_flow_col), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_load =</span> <span class="fu">mean</span>(load_kg_d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_load =</span> <span class="fu">median</span>(load_kg_d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_load_est =</span> <span class="fu">sum</span>(load_kg_d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_load))</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display loading summary</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  load_summary <span class="sc">%&gt;%</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Metal Loading Analysis by Season"</span>,</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metal"</span>, <span class="st">"Season"</span>, <span class="st">"N Samples"</span>, <span class="st">"Mean Conc (mg/L)"</span>, <span class="st">"Mean Flow (L/s)"</span>,</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Mean Load (kg/d)"</span>, <span class="st">"Median Load (kg/d)"</span>, <span class="st">"Total Load Est (kg/d)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Metal Loading Analysis by Season</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Metal</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Samples</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean Conc (mg/L)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean Flow (L/s)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean Load (kg/d)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Median Load (kg/d)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total Load Est (kg/d)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ZN</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">4701.0884</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0484</td>
<td style="text-align: right;">0.0098</td>
<td style="text-align: right;">0.7749</td>
</tr>
<tr class="even">
<td style="text-align: left;">FE</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">6838.6873</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0306</td>
<td style="text-align: right;">0.0155</td>
<td style="text-align: right;">0.8563</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FE</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">2500.7105</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0275</td>
<td style="text-align: right;">0.0038</td>
<td style="text-align: right;">0.4396</td>
</tr>
<tr class="even">
<td style="text-align: left;">ZN</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">3104.3213</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0257</td>
<td style="text-align: right;">0.0060</td>
<td style="text-align: right;">0.7208</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AL</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">455.9642</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0056</td>
<td style="text-align: right;">0.0022</td>
<td style="text-align: right;">0.0896</td>
</tr>
<tr class="even">
<td style="text-align: left;">AL</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">798.0453</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0043</td>
<td style="text-align: right;">0.0024</td>
<td style="text-align: right;">0.1204</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MN</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">55.7093</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0008</td>
<td style="text-align: right;">0.0002</td>
<td style="text-align: right;">0.0226</td>
</tr>
<tr class="even">
<td style="text-align: left;">CU</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">31.2344</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0007</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0105</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AS</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">32.6511</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0006</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0098</td>
</tr>
<tr class="even">
<td style="text-align: left;">MN</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">82.6421</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0005</td>
<td style="text-align: right;">0.0003</td>
<td style="text-align: right;">0.0080</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AS</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">89.0347</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0004</td>
<td style="text-align: right;">0.0001</td>
<td style="text-align: right;">0.0110</td>
</tr>
<tr class="even">
<td style="text-align: left;">CU</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">47.7650</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0003</td>
<td style="text-align: right;">0.0001</td>
<td style="text-align: right;">0.0090</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CD</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">17.5158</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0002</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0030</td>
</tr>
<tr class="even">
<td style="text-align: left;">CD</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">10.7884</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0001</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0021</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PB</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">2.8956</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0001</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0009</td>
</tr>
<tr class="even">
<td style="text-align: left;">PB</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">6.2606</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0013</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CO</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">2.4842</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0004</td>
</tr>
<tr class="even">
<td style="text-align: left;">NI</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">2.8122</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0005</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NI</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">2.6280</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0003</td>
</tr>
<tr class="even">
<td style="text-align: left;">CO</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">2.4374</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0004</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: left;">dry</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.1147</td>
<td style="text-align: right;">0.1113</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: left;">wet</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0.3375</td>
<td style="text-align: right;">0.2271</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AL</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.1200</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">AS</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CD</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0870</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">CO</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0180</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0040</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">CU</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.6000</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FE</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.3600</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">MN</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.6500</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NI</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0780</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">PB</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0420</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ZN</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14.3000</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="loading-visualization" class="level3">
<h3 class="anchored" data-anchor-id="loading-visualization">Loading Visualization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"amd_long"</span>)) {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Top loading metals</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  top_loading_metals <span class="ot">&lt;-</span> load_summary <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(metal) <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">total_load =</span> <span class="fu">sum</span>(total_load_est, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(total_load, <span class="at">n =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(metal)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loading comparison plot</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  p_loading <span class="ot">&lt;-</span> amd_long <span class="sc">%&gt;%</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(metal <span class="sc">%in%</span> top_loading_metals) <span class="sc">%&gt;%</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(metal, <span class="sc">-</span>load_kg_d), <span class="at">y =</span> load_kg_d, <span class="at">fill =</span> season)) <span class="sc">+</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">outlier.shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">name =</span> <span class="st">"Season"</span>) <span class="sc">+</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Metal"</span>,</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Daily Load (kg/d, log scale)"</span>,</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Metal Loading Comparison by Season"</span>,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Top 8 metals by loading"</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p_loading)</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strosnider_2011_06_files/figure-html/load-viz-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="summary-and-conclusions" class="level2">
<h2 class="anchored" data-anchor-id="summary-and-conclusions">Summary and Conclusions</h2>
<section id="key-findings" class="level3">
<h3 class="anchored" data-anchor-id="key-findings">Key Findings</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== KEY FINDINGS SUMMARY ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== KEY FINDINGS SUMMARY ===</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pH summary</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>ph_summary <span class="ot">&lt;-</span> amd_enhanced <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_ph =</span> <span class="fu">mean</span>(p_h, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_ph =</span> <span class="fu">median</span>(p_h, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_ph =</span> <span class="fu">min</span>(p_h, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_ph =</span> <span class="fu">max</span>(p_h, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_acidic =</span> <span class="fu">sum</span>(p_h <span class="sc">&lt;</span> <span class="dv">7</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_h)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_very_acidic =</span> <span class="fu">sum</span>(p_h <span class="sc">&lt;</span> <span class="dv">4</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_h)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"pH Characteristics:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>pH Characteristics:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Mean pH:"</span>, <span class="fu">round</span>(ph_summary<span class="sc">$</span>mean_ph, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Mean pH: 3.6 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Median pH:"</span>, <span class="fu">round</span>(ph_summary<span class="sc">$</span>median_ph, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Median pH: 3.15 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• pH Range:"</span>, <span class="fu">round</span>(ph_summary<span class="sc">$</span>min_ph, <span class="dv">2</span>), <span class="st">"-"</span>, <span class="fu">round</span>(ph_summary<span class="sc">$</span>max_ph, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• pH Range: 0.9 - 6.9 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Acidic samples (pH &lt; 7):"</span>, <span class="fu">round</span>(ph_summary<span class="sc">$</span>pct_acidic, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Acidic samples (pH &lt; 7): 100 %</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Very acidic samples (pH &lt; 4):"</span>, <span class="fu">round</span>(ph_summary<span class="sc">$</span>pct_very_acidic, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Very acidic samples (pH &lt; 4): 81.8 %</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Metal summary</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_metals) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"risk_summary"</span>)) {</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  high_risk_metals <span class="ot">&lt;-</span> risk_summary <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(overall_risk <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Critical"</span>, <span class="st">"High"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>()</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Metal Contamination:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"• Metals analyzed:"</span>, <span class="fu">length</span>(available_metals), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"• High/Critical risk metals:"</span>, high_risk_metals, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"• Most problematic metals:"</span>, <span class="fu">paste</span>(<span class="fu">head</span>(risk_summary<span class="sc">$</span>metal, <span class="dv">3</span>), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Metal Contamination:
• Metals analyzed: 11 
• High/Critical risk metals: 9 
• Most problematic metals: MN, AL, CD </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal patterns</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"seasonal_tests"</span>)) {</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  significant_seasonal <span class="ot">&lt;-</span> seasonal_tests <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(significant <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>()</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Seasonal Patterns:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"• Metals with significant seasonal differences:"</span>, significant_seasonal, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Seasonal Patterns:
• Metals with significant seasonal differences: 0 </code></pre>
</div>
</div>
</section>
<section id="recommendations" class="level3">
<h3 class="anchored" data-anchor-id="recommendations">Recommendations</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== MANAGEMENT RECOMMENDATIONS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== MANAGEMENT RECOMMENDATIONS ===</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Priority sites</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>priority_sites <span class="ot">&lt;-</span> site_summary <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Highly Acidic"</span>, <span class="st">"Acidic"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(mean_ph, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(site)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Priority Sites for Intervention:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Priority Sites for Intervention:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (site <span class="cf">in</span> priority_sites) {</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  site_info <span class="ot">&lt;-</span> site_summary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site <span class="sc">==</span> <span class="sc">!!</span>site)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"• "</span>, site, <span class="st">" (Mean pH: "</span>, <span class="fu">round</span>(site_info<span class="sc">$</span>mean_ph, <span class="dv">2</span>), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• 4T (Mean pH: 0.9)
• 7C (Mean pH: 2.1)
• 2A (Mean pH: 2.3)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment recommendations</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Treatment Recommendations:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Treatment Recommendations:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Implement active treatment systems for sites with pH &lt; 4</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Implement active treatment systems for sites with pH &lt; 4</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Consider passive treatment (wetlands) for moderately acidic sites</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Consider passive treatment (wetlands) for moderately acidic sites</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Establish regular monitoring for high-risk metals</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Establish regular monitoring for high-risk metals</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Develop seasonal management strategies based on flow variations</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Develop seasonal management strategies based on flow variations</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitoring recommendations</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Monitoring Recommendations:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Monitoring Recommendations:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Increase sampling frequency during wet season</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Increase sampling frequency during wet season</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Focus on high-loading metals for impact assessment</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Focus on high-loading metals for impact assessment</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Implement real-time pH monitoring at critical sites</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Implement real-time pH monitoring at critical sites</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Establish downstream impact monitoring network</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• Establish downstream impact monitoring network</code></pre>
</div>
</div>
</section>
<section id="data-export" class="level3">
<h3 class="anchored" data-anchor-id="data-export">Data Export</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export summary data for further analysis</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"amd_enhanced"</span>)) {</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(amd_enhanced, <span class="st">"amd_enhanced_dataset.csv"</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ Enhanced dataset exported to 'amd_enhanced_dataset.csv'</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Enhanced dataset exported to 'amd_enhanced_dataset.csv'</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"risk_summary"</span>)) {</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(risk_summary, <span class="st">"risk_assessment_summary.csv"</span>)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ Risk assessment exported to 'risk_assessment_summary.csv'</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Risk assessment exported to 'risk_assessment_summary.csv'</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"site_summary"</span>)) {</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(site_summary, <span class="st">"site_characterization_summary.csv"</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ Site summary exported to 'site_characterization_summary.csv'</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Site summary exported to 'site_characterization_summary.csv'</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== ANALYSIS COMPLETE ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== ANALYSIS COMPLETE ===</code></pre>
</div>
</div>
</section>
<section id="final-summary" class="level3">
<h3 class="anchored" data-anchor-id="final-summary">Final Summary</h3>
<p>This report provides a comprehensive visualization of the acid mine drainage (AMD) discharges from Cerro Rico, Potosí, based on data collected by Strosnider et al.&nbsp;(2011). The HTML accurately captures the spatial and seasonal heterogeneity of AMD quality, highlighting extreme concentrations of ecotoxic metals such as iron (Fe), zinc (Zn), and aluminum (Al), especially at high-risk sites like 4T. The visualizations also confirm that nearly all sampled sites exceed Bolivian legal discharge limits, often by several orders of magnitude. Seasonal differences are well represented, with greater metal loading observed during the wet season. Overall, this report reinforces the urgent need for remediation and regulatory enforcement and serves as a powerful companion to the original scientific study.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="strosnider_2011_06_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>